version: 2
jobs:
  build:
    docker:
      - image: circleci/node:8.11
    working_directory: ~/repo
    steps:
        - checkout
        - run: yarn install
        - run: yarn test
        - run:
            command: |
              wget -qO- https://cli.netlify.com/download/latest/linux | tar xvz
        - deploy:
            command: |
              if [ "${CIRCLE_BRANCH}" == "test1" ]; then
                yarn run build
                ./netlifyctl deploy --access-token=$NETLIFY_AUTH_TOKEN --site-id=$NETLIFY_SITE_ID_STAGING --publish-directory=build
              fi
